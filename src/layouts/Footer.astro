---
// src/layouts/Footer.astro
import Button from "@/components/Button/Button";
import Heading from "@/components/Heading";
import PreferencesLayout from "./PreferencesLayout.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import SubscribeForm from "@/components/Form/forms/SubscribeForm.astro";
import Logo from "@/components/Logo.astro";
import { siteData } from "@/content/siteData";
import { hasParent, query, relatedRoots, sortByOrder } from "@/utils/query";

const { class: className = "" } = Astro.props;

const currentYear = new Date().getFullYear();
const contactEntries = (await query("contact-us").orderBy(sortByOrder()).get()).entries;

---

<footer class={`bg-primary text-light-primary border-x-3 border-b-3 border-light-primary ${className}`}>
  <!-- Newsletter & Social Section -->
  <div class="py-12 md:py-16">
    <div class="inner-section mx-auto">
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-8 lg:gap-16">
        <!-- Newsletter Signup -->
        <div class="flex-1 max-w-2xl">
          <Heading tagName="h3" className="h3 font-bold text-light-primary mb-6">
            Subscribe To Our Newsletter!
          </Heading>
          <SubscribeForm />
        </div>

        <!-- Social Media -->
        <div class="text-center">
          <Heading tagName="h3" className="h3 font-bold text-left text-light-primary mb-4">
            Follow Us!
          </Heading>
          <ContentRenderer
            query={query("social-media")}
            variant="SocialMediaVariant"
            size="lg"
            layout="horizontal"
            alignment="left"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Main Footer Content -->
  <div class="py-12 md:py-16 border-y-3 border-light-primary">
    <div class="inner-section mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8">
        <!-- Logo + Contact + Social -->
        <div class="flex flex-col gap-6 min-w-0">
          <Logo
            imageClass="w-14 lg:w-16 h-auto"
            width={80}
            height={80}
          />
                    {contactEntries.length > 0 && (
            <ul class="flex flex-col gap-2 list-none m-0 p-0 max-w-[260px]">
              {contactEntries.map((entry) => {
                const data = entry.data;
                const href = data.linkPrefix ? `${data.linkPrefix}${data.title}` : undefined;
                return (
                  <li>
                    <Button
                      variant="hoverUnderline"
                      href={href}
                      className="text-light-primary/90 hover:text-light-primary text-sm lg:text-base break-all"
                      leftIcon={data.icon}
                      size="sm"
                    >
                      {data.title}
                    </Button>
                  </li>
                );
              })}
            </ul>
          )}
          <p class="text-light-primary/90 text-sm lg:text-base leading-relaxed">
            {siteData.description}
          </p>

        </div>
        <!-- Footer Menu -->
        <div>
          <ContentRenderer
            query={relatedRoots("menu-items", "menu", "footer-menu").orderBy(sortByOrder())}
            variant="MenuVariant"
            mode="flat-only"
            maxDepth={1}
            listClassName="space-y-4 list-none m-0 p-0"
            title="Footer Menu"
            showTitle={true}
          />

          <div class="mt-8">
            <ContentRenderer
              query={query("study-groups").orderBy(sortByOrder())}
              variant="MenuVariant"
              mode="flat-only"
              maxDepth={1}
              listClassName="space-y-4 list-none m-0 p-0"
              title="Study Groups"
              showTitle={true}
            />
          </div>
        </div>

        <!-- Resources -->
        <div>
          <ContentRenderer
            query={query("legal").orderBy(sortByOrder())}
            variant="MenuVariant"
            mode="flat-only"
            listClassName="space-y-4 list-none m-0 p-0"
            title="Resources"
            showTitle={true}
          />
          <div class="mt-8">
            <Heading tagName="h4" className="h5 font-bold text-light-primary mb-4 uppercase tracking-wide">
              Preferences
            </Heading>
            <PreferencesLayout
              layout="vertical"
              linkClassName="text-light-primary/90 hover:text-light-primary text-base lg:text-lg inline-flex items-center gap-2 font-semibold no-underline hover:underline underline-offset-4 transition-colors duration-200"
              buttonClassName="text-light-primary/90 hover:text-light-primary text-base lg:text-lg"
              buttonVariant="hoverUnderline"
              buttonSize="sm"
            />
          </div>
        </div>

        <!-- Featured Special -->
        <div>
          <Heading tagName="h4" className="h5 font-bold text-light-primary mb-6 uppercase tracking-wide">
            Featured Special
          </Heading>
          <div class="text-light-primary/90">
            <Button variant="link">Summer Special</Button>
          </div>
        </div>

        <!-- Pick Your Part -->
        <div>
          <Heading tagName="h4" className="h5 font-bold text-light-primary mb-6 uppercase tracking-wide">
            Pick Your Part
          </Heading>
          <ContentRenderer
            query={hasParent("part")}
            variant="FooterPartsVariant"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Bar -->
  <div class="inner-section mx-auto py-5">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4 text-light-primary text-lg">
      <div class="flex items-center gap-2">
        Â© {currentYear} {siteData.legalName}. All Rights Reserved.
      </div>
      <div>
        <span>
          Powered By
          <a href="https://griffinswebservices.com" class="hover:underline transition-all duration-300">
            Griffin's Web Services
          </a>
        </span>
      </div>
    </div>
  </div>
</footer>
