---
// src/layouts/Header.astro
/**
 * Site Header (Highway Sign style)
 */
import { Image } from "astro:assets";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import Button from "@/components/Button/Button";
import Logo from "@/components/Logo.astro";
import { related, sortByOrder } from "@/utils/query";
import { siteData } from "@/content/siteData";
import CircleArrow from "@/assets/i75/circle-arrow.png";
import StraightArrow from "@/assets/i75/straight-arrow.png";
import HeaderLanguageSwitcher from "@/integrations/preferences/language/ui/HeaderLanguageSwitcher";
---

<header class="bg-primary w-screen sticky top-0 shadow-2xl z-[99]">
  <div class="header-top p-2 flex justify-center items-center rounded-xl border-3 border-light-primary">
    <div class="flex items-center gap-3 text-light-primary text-sm lg:text-base font-medium">
      <Image src={StraightArrow} alt="Highway arrow" class="w-6 h-6" width={60} height={60} />
      <span class="text-lg lg:text-xl">{siteData.topBarText}</span>
    </div>
  </div>
  <div class="header-middle h-19 lg:h-21 flex items-center justify-center rounded-xl border-3 border-light-primary">
    <div class="w-95/100 h-full mx-auto flex items-center justify-between gap-4">
      <div class="nav-left shrink-0 flex items-center gap-5">
      <Logo />
       <Image src={CircleArrow} alt="Highway arrow" class="w-6 lg:w-9 h-auto" width={60} height={60} />
     </div>

      <div class="nav-center hidden lg:flex flex-1 items-center justify-center">
        <!-- Desktop Navigation Menu -->
        <ContentRenderer
          query={related("menu-items", "menu", "main-menu").orderBy(sortByOrder())}
          variant="MenuVariant"
          mode="responsive"
          className="header-navigation"
        />
      </div>

      <div class="nav-right shrink-0 h-full flex items-center gap-2 ml-auto">
        <!-- Mobile Hamburger Menu -->
        <ContentRenderer
          query={related("menu-items", "menu", "main-menu").orderBy(sortByOrder())}
          variant="MenuVariant"
          mode="hamburger-only"
          className="header-navigation lg:hidden order-3 lg:order-none"
          hamburgerTransform={true}
        />

        <!-- Language Switcher -->
        <div class="order-1 lg:order-none">
          <HeaderLanguageSwitcher client:load />
        </div>

        <!-- My Account Button -->
        <Button
          href="https://course.i75cpa.com/account/login"
          variant="hoverUnderline"
          target="_blank"
          rel="noopener noreferrer"
          className="order-2 lg:order-none flex items-center gap-2 transition-colors font-normal text-base lg:text-lg text-light-primary hover:text-light-primary/90"
        >
          <!-- Account icon -->
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"
            />
          </svg>
          <!-- Text - desktop only -->
          <span class="hidden lg:inline">Login</span>
        </Button>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const header = document.querySelector("header");
  if (header) {
    const setHeaderBottom = () => {
      const rect = header.getBoundingClientRect();
      document.documentElement.style.setProperty("--header-bottom", `${rect.bottom}px`);
    };

    setHeaderBottom();
    const observer = new ResizeObserver(setHeaderBottom);
    observer.observe(header);

    window.addEventListener("resize", setHeaderBottom);
    window.addEventListener("scroll", setHeaderBottom, { passive: true });
  }

  const topLevelItems = document.querySelectorAll(
    ".menu-desktop > ul > li.menu-item"
  );
  const updateDropdownLeft = (el) => {
    if (!el) return;
    const rect = el.getBoundingClientRect();
    document.documentElement.style.setProperty("--menu-dropdown-left", `${rect.left}px`);
  };

  topLevelItems.forEach((item) => {
    item.addEventListener("mouseenter", () => updateDropdownLeft(item));
    item.addEventListener("focusin", () => updateDropdownLeft(item));
  });
</script>
