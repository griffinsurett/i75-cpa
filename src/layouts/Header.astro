---
// src/layouts/Header.astro
/**
 * Site Header (Highway Sign style)
 */
import { Image } from "astro:assets";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import { related, sortByOrder } from "@/utils/query";
import { siteData } from "@/content/siteData";
import CircleArrow from "@/assets/i75/circle-arrow.png";
import StraightArrow from "@/assets/i75/straight-arrow.png";
---

<header class="bg-primary w-screen sticky top-0 shadow-2xl z-[99999]">
  <div class="header-top p-2 flex justify-center items-center rounded-xl border-3 border-light-primary">
    <div class="flex items-center gap-3 text-light-primary text-sm lg:text-base font-medium">
      <Image src={StraightArrow} alt="Highway arrow" class="w-6 h-6" width={60} height={60} />
      <span class="text-lg lg:text-xl">{siteData.topBarText}</span>
    </div>
  </div>
  <div class="header-middle h-19 lg:h-21 flex items-center justify-center rounded-xl border-3 border-light-primary">
    <div class="w-95/100 mx-auto flex justify-between items-center">
      <div class="nav-left flex items-center gap-5">
      <a class="logo flex items-center gap-3" href="/">
        <Image
          src={siteData.logo}
          alt={`${siteData.title} Logo`}
          class="w-12 lg:w-15 h-auto"
          width={70}
          height={70}
        />
        <span class="flex flex-col p-0 leading-tight text-light-primary">
          <span class="text-lg md:text-xl lg:text-2xl font-semibold">CPA Review</span>
          <span class="text-sm lg:text-base font-normal opacity-90 -mt-0.5">The Right Road</span>
        </span>
      </a>
       <Image src={CircleArrow} alt="Highway arrow" class="w-6 lg:w-9 h-auto" width={60} height={60} />
     </div>
            <!-- Navigation Menu using query (kept for later) -->
      
           <!-- <div class="nav-right flex-grow"> -->
      <ContentRenderer
        query={related("menu-items", "menu", "main-menu").orderBy(sortByOrder())}
        variant="MenuVariant"
        mode="responsive"
        className="header-navigation"
        hamburgerTransform={true}
      />
      <!-- </div> -->
    </div>
  </div>
</header>

<script is:inline>
  const header = document.querySelector("header");
  if (header) {
    const setHeaderBottom = () => {
      const rect = header.getBoundingClientRect();
      document.documentElement.style.setProperty("--header-bottom", `${rect.bottom}px`);
    };

    setHeaderBottom();
    const observer = new ResizeObserver(setHeaderBottom);
    observer.observe(header);

    window.addEventListener("resize", setHeaderBottom);
    window.addEventListener("scroll", setHeaderBottom, { passive: true });
  }

  const topLevelItems = document.querySelectorAll(".menu-desktop .menu-item");
  const updateDropdownLeft = (el) => {
    if (!el) return;
    const rect = el.getBoundingClientRect();
    document.documentElement.style.setProperty("--menu-dropdown-left", `${rect.left}px`);
  };

  topLevelItems.forEach((item) => {
    item.addEventListener("mouseenter", () => updateDropdownLeft(item));
    item.addEventListener("focusin", () => updateDropdownLeft(item));
  });
</script>
