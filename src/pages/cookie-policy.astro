---
// src/pages/cookie-policy.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import { siteData } from "@/content/siteData";
import { formatPhoneNumber } from "@/utils/string";
import { find } from "@/utils/query";

// Query contact information dynamically from contact-us collection by ID
const emailEntry = await find('contact-us', 'email');
const phoneEntry = await find('contact-us', 'phone');

const effectiveDate = "May 14, 2025";
---

<BaseLayout
  title="Cookie Policy"
  description={`How ${siteData.title} uses cookies.`}
>
  <article class="prose prose-lg mx-auto py-16 px-6 max-w-4xl">
    <h1>Cookie Policy for {siteData.title}</h1>
    
    <p>
      For details on how we collect and use all personal data, see our
      <a href="/privacy-policy" class="underline">Privacy Policy</a>.
    </p>

    <p><em>Effective date:</em> {effectiveDate}</p>

    <h2>What Are Cookies?</h2>
    <p>
      Cookies are small text files placed by your browser when you visit a
      website. They store data such as session identifiers, preferences, and
      analytics.
    </p>

    <h2>How We Use Cookies</h2>
    <ul>
      <li>Ensure core site functionality (e.g., form submissions).</li>
      <li>Remember your preferences (language, theme).</li>
      <li>Measure and analyze site traffic.</li>
      <li>Deliver personalized advertising (with consent).</li>
    </ul>

    <h2>Types of Cookies</h2>
    <ul>
      <li><strong>Necessary:</strong> Essential for site operation.</li>
      <li><strong>Preferences:</strong> Store your choices.</li>
      <li><strong>Statistics:</strong> Collect anonymous usage data.</li>
      <li><strong>Marketing:</strong> Track for relevant ads.</li>
    </ul>

    <h2>Managing Cookies</h2>
    <p>
      You can disable cookies via your browser settings. Please note that some
      features may not work correctly if cookies are disabled.
    </p>

    <h2>Detected Cookies</h2>
    <p>
      This table lists every cookie set by your browser for {siteData.title}.
      It's generated dynamically—any new cookies will appear automatically.
    </p>
    <div id="cookie-table-container">
      <p>Loading cookies…</p>
    </div>

    <h2>Your Rights & Consent</h2>
    <p>
      Under GDPR, you must consent before non‑essential cookies are set. Under
      CCPA, you can opt out of the sale of your personal data.
    </p>

    <h2>Contact Us</h2>
    <p>If you have questions, reach us at:</p>
    <ul>
      {emailEntry && (
        <li>
          <strong>Email:</strong>{' '}
          <a 
            href={`${emailEntry.data.linkPrefix || 'mailto:'}${emailEntry.data.title}`}
            class="underline hover:text-blue-600"
          >
            {emailEntry.data.title}
          </a>
        </li>
      )}
      {phoneEntry && (
        <li>
          <strong>Phone:</strong>{' '}
          <a 
            href={`${phoneEntry.data.linkPrefix || 'tel:'}${phoneEntry.data.title}`}
            class="underline hover:text-blue-600"
          >
            {formatPhoneNumber(phoneEntry.data.title)}
          </a>
        </li>
      )}
      {siteData.address ? (
        <li><strong>Address:</strong> {siteData.address}</li>
      ) : siteData.location && (
        <li><strong>Location:</strong> {siteData.location}</li>
      )}
    </ul>
  </article>
</BaseLayout>