---
import type { BaseVariantProps } from "../ContentRenderer.types";
import Heading from "@/components/Heading";
import TestimonialCard from "@/components/TestimonialCard.astro";
import Button from "@/components/Button/Button";
import { shouldShowCollectionCTA } from "../utils/helpers";
import { siteData } from "@/content/siteData";

const {
  items = [],
  className = "",
  id,
  collectionUrl,
  showButtonSection = true,
  primaryButtonText = siteData.mainCTAText ?? "Get On The Right Road",
  primaryButtonHref = siteData.mainCTAurl ?? "/",
  secondaryButtonText = "See All Success Stories",
} = Astro.props as BaseVariantProps & {
  primaryButtonText?: string;
  primaryButtonHref?: string;
  secondaryButtonText?: string;
};
---

<section id={id} class={`${className}`}>
  <div class="w-85/100 max-w-7xl mx-auto">
    <div class="text-center space-y-4 mb-10 flex flex-col gap-2">
      <Heading
        tagName="h2"
        className="h2 font-bold text-light-primary"
        before="i75"
        text="ers"
        after=" Have A Much Easier Time Passing The Exam Than Their Counterparts"
        textClass="beforeAndAfterHeadingClass"
        afterClass="beforeAndAfterHeadingClass"
      />
      <p class="h4 text-light-tertiary max-w-3xl mx-auto">Hereâ€™s what they said...</p>
    </div>

    <div class="columns-1 md:columns-2 lg:columns-3 xl:columns-4 gap-6 [column-fill:_balance]">
      {items.map((t) => {
        const isVideo = Boolean(t.videoUrl || t.videoThumbnail);
        const videoThumbnail = isVideo
          ? t.videoThumbnail ?? t.bannerImage ?? t.featuredImage
          : undefined;

        return (
          <div class="mb-6 break-inside-avoid inline-block w-full">
            <TestimonialCard
              type={isVideo ? "video" : "text"}
              name={t.title}
              title={t.role}
              company={t.company}
              avatar={t.featuredImage}
              testimonial={t.description}
              rating={t.rating}
              videoUrl={t.videoUrl}
              videoThumbnail={videoThumbnail}
              orientation={t.orientation}
            />
          </div>
        );
      })}
    </div>

    {
      showButtonSection && (
        <div class="mt-12 flex flex-col items-center gap-3">
          <Button
            variant="secondary"
            href={primaryButtonHref}
            className="h5 w-full sm:w-auto"
          >
            {primaryButtonText}
          </Button>

          {
            shouldShowCollectionCTA(collectionUrl, items.length) && (
              <Button
                variant="underline"
                href={collectionUrl}
                className="w-full font-bold sm:w-auto uppercase text-light-primary hover:text-light-primary/90"
              >
                {secondaryButtonText}
              </Button>
            )
          }
        </div>
      )
    }
  </div>
</section>
