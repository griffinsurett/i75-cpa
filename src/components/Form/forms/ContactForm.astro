---
// src/components/Form/forms/ContactForm.astro
/**
 * Contact Form - Astro Version
 * Pure HTML with optional React enhancement via client:idle
 */
import Button from "@/components/Button/Button";
import FormWrapper from "@/components/Form/FormWrapper";
import Input from "@/components/Form/inputs/Input";
import Checkbox from "@/components/Form/inputs/Checkbox";
import Textarea from "@/components/Form/inputs/Textarea";
import { submitToFormspree } from "@/utils/formspree";

interface Props {
  title?: string;
  description?: string;
  className?: string;
}

const { title, description, className = "" } = Astro.props;

const FORMSPREE_BASE_ACTION = "https://formspree.io/f/";
const contactFormId = import.meta.env.PUBLIC_FORMSPREE_CONTACT_ID;
const contactFormAction = contactFormId
  ? `${FORMSPREE_BASE_ACTION}${contactFormId}`
  : undefined;

const handleSubmit = async (values: Record<string, unknown>) => {
  if (!contactFormAction) {
    throw new Error("Contact form is temporarily unavailable. Please try again later.");
  }

  await submitToFormspree({
    endpoint: contactFormAction,
    values,
    formName: "Contact Form",
    excludeKeys: ["privacy"],
  });
};
---

<div class={className}>
  {title && <h2 class="text-3xl font-bold mb-3">{title}</h2>}
  {description && <p class="text-text mb-8">{description}</p>}

  <FormWrapper
    client:idle
    onSubmit={handleSubmit}
    successMessage="Thank you for contacting us! We'll get back to you soon."
    errorMessage="There was an error submitting your form. Please try again."
    resetOnSuccess={true}
    className="w-full"
  >
    <div class="form-two-col">
      <Input
        name="firstName"
        label="First Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="First Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark"
      />

      <Input
        name="lastName"
        label="Last Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="Last Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark"
      />
    </div>

    <div class="form-two-col">
      <Input
        name="email"
        label="Email"
        type="email"
        required={true}
        placeholder="me@website.com"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark"
      />

      <Input
        name="phone"
        label="Phone Number"
        type="tel"
        required={true}
        pattern="[0-9]{10,}"
        title="Please enter at least 10 digits"
        placeholder="012-345-6789"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark"
      />
    </div>

    <Input
      name="company"
      label="Company Name"
      type="text"
      placeholder="LLC or whatever you trade as"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark"
    />

    <Textarea
      name="message"
      label="Your Message"
      required={true}
      minLength={10}
      placeholder="Write your message here..."
      rows={5}
      containerClassName="mb-4"
      textareaClassName="w-full px-4 py-3 bg-transparent border-0 rounded-md ring-3 ring-white focus:outline-none focus:ring-3 focus:ring-MainDark resize-vertical"
    />

    <Checkbox
      name="privacy"
      required
      containerClassName="mb-6"
      checkboxClassName="w-4 h-4 text-MainDark border-surface rounded"
    >
      I have read and agree to the{" "}
      <Button
        variant="link"
        href="/privacy-policy"
        target="_blank"
        rel="noopener noreferrer"
      >
        Privacy Policy
      </Button>
    </Checkbox>

    <Button variant="secondary" type="submit" className="w-full mx-auto">
      Submit Form
    </Button>
  </FormWrapper>
</div>
