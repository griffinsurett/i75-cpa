---
// src/components/Form/forms/MilitaryDiscountForm.astro
/**
 * Military Discount Form - For veterans and active duty members
 * Adapted for i75 CPA Review
 */
import Button from "@/components/Button/Button";
import FormWrapper from "@/components/Form/FormWrapper";
import Input from "@/components/Form/inputs/Input";
import Checkbox from "@/components/Form/inputs/Checkbox";
import Textarea from "@/components/Form/inputs/Textarea";
import FileInput from "@/components/Form/inputs/FileInput";
import { submitToFormspree } from "@/utils/formspree";

interface Props {
  title?: string;
  description?: string;
  className?: string;
}

const { title, description, className = "" } = Astro.props;

const FORMSPREE_BASE_ACTION = "https://formspree.io/f/";
const militaryFormId = import.meta.env.PUBLIC_FORMSPREE_MILITARY_DISCOUNT_ID;
const militaryFormAction = militaryFormId
  ? `${FORMSPREE_BASE_ACTION}${militaryFormId}`
  : undefined;

const handleSubmit = async (values: Record<string, unknown>) => {
  if (!militaryFormAction) {
    throw new Error("Military discount form is temporarily unavailable. Please try again later.");
  }

  await submitToFormspree({
    endpoint: militaryFormAction,
    values,
    formName: "Military Discount Request",
    excludeKeys: ["privacy"],
  });
};

 
---

<div class={className}>
  {title && <h2 class="text-3xl font-bold mb-3">{title}</h2>}
  {description && <p class="text-text mb-8">{description}</p>}

  <FormWrapper
    client:idle
    onSubmit={handleSubmit}
    successMessage="Thank you for your service! We'll review your information and send your discount code within 24-48 hours."
    errorMessage="There was an error submitting your form. Please try again."
    resetOnSuccess={true}
    className="w-full"
  >
    <div class="flex flex-col lg:flex-row justify-between gap-2 mb-4">
      <Input
        name="firstName"
        label="First Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="First Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
      />

      <Input
        name="lastName"
        label="Last Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="Last Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
      />
    </div>

    <Input
      name="email"
      label="Email"
      type="email"
      required={true}
      placeholder="your.email@example.com"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <FileInput
      name="militaryId"
      label="Upload DD-256"
      required={true}
      accept=".pdf,.jpg,.jpeg,.png"
      containerClassName="mb-4"
    />

    <Input
      name="subject"
      label="Subject"
      type="text"
      required={true}
      placeholder="Subject"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <Textarea
      name="message"
      label="Your Message"
      required={true}
      placeholder="Your Message"
      rows={4}
      containerClassName="mb-4"
      textareaClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark resize-vertical"
    />

    <Checkbox
      name="privacy"
      required
      containerClassName="mb-6"
      checkboxClassName="w-4 h-4 text-MainDark border-surface rounded"
    >
      I consent to have this website store my submitted information so they can respond to my inquiry
    </Checkbox>

    <Button variant="secondary" type="submit" className="w-full mx-auto">
      Submit Form
    </Button>
  </FormWrapper>
</div>
