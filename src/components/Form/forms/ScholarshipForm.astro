---
// src/components/Form/forms/ScholarshipForm.astro
/**
 * Scholarship Application Form
 * For i75 CPA Review scholarship applications
 */
import Button from "@/components/Button/Button";
import FormWrapper from "@/components/Form/FormWrapper";
import Input from "@/components/Form/inputs/Input";
import Select from "@/components/Form/inputs/Select";
import Textarea from "@/components/Form/inputs/Textarea";
import Checkbox from "@/components/Form/inputs/Checkbox";
import CheckboxParts from "@/components/Form/CheckboxParts.astro";
import { submitToFormspree } from "@/utils/formspree";

interface Props {
  title?: string;
  description?: string;
  className?: string;
}

const { title, description, className = "" } = Astro.props;

const FORMSPREE_BASE_ACTION = "https://formspree.io/f/";
const scholarshipFormId = import.meta.env.PUBLIC_FORMSPREE_SCHOLARSHIP_ID;
const scholarshipFormAction = scholarshipFormId
  ? `${FORMSPREE_BASE_ACTION}${scholarshipFormId}`
  : undefined;

const handleSubmit = async (values: Record<string, unknown>) => {
  if (!scholarshipFormAction) {
    throw new Error("Scholarship form is temporarily unavailable. Please try again later.");
  }

  await submitToFormspree({
    endpoint: scholarshipFormAction,
    values,
    formName: "Scholarship Application",
    excludeKeys: ["privacy", "commitment"],
  });
};

const educationLevels = [
  { value: "current-student", label: "Currently Enrolled in College/University" },
  { value: "recent-graduate", label: "Recent Graduate (within 2 years)" },
  { value: "working-professional", label: "Working Professional" },
  { value: "career-changer", label: "Career Changer" },
];
---

<div class={className}>
  {title && <h2 class="text-3xl font-bold mb-3">{title}</h2>}
  {description && <p class="text-text mb-8">{description}</p>}

  <FormWrapper
    client:idle
    onSubmit={handleSubmit}
    successMessage="Thank you for your scholarship application! We'll review it and get back to you within 2-3 weeks."
    errorMessage="There was an error submitting your application. Please try again."
    resetOnSuccess={true}
    className="w-full"
  >
    <div class="flex flex-col lg:flex-row justify-between gap-2 mb-4">
      <Input
        name="firstName"
        label="First Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="First Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
      />

      <Input
        name="lastName"
        label="Last Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="Last Name"
        containerClassName="mb-0 flex-1"
        inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
      />
    </div>

    <Input
      name="email"
      label="Email"
      type="email"
      required={true}
      placeholder="your.email@example.com"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <Input
      name="phone"
      label="Phone Number"
      type="tel"
      required={true}
      pattern="[0-9]{10,}"
      title="Please enter at least 10 digits"
      placeholder="012-345-6789"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <Select
      name="educationLevel"
      label="Current Education/Career Status"
      options={educationLevels}
      required={true}
      placeholder="Select your status"
      containerClassName="mb-4"
      selectClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <Input
      name="school"
      label="School/University (if applicable)"
      type="text"
      placeholder="Enter your school name"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <CheckboxParts
      name="passedParts"
      label="What Parts Have You Already Passed?"
      includeNone={true}
    />

    <Input
      name="examDate"
      label="Target Exam Date (if known)"
      type="date"
      containerClassName="mb-4"
      inputClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark"
    />

    <Textarea
      name="financialNeed"
      label="Please describe your financial situation and why you need scholarship assistance"
      required={true}
      minLength={50}
      placeholder="Tell us about your circumstances..."
      rows={4}
      containerClassName="mb-4"
      textareaClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark resize-vertical"
    />

    <Textarea
      name="whyCPA"
      label="Why do you want to become a CPA?"
      required={true}
      minLength={50}
      placeholder="Share your motivation and career goals..."
      rows={4}
      containerClassName="mb-4"
      textareaClassName="w-full px-4 py-3 bg-surface border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-MainDark resize-vertical"
    />

    <Checkbox
      name="commitment"
      required
      containerClassName="mb-4"
      checkboxClassName="w-4 h-4 text-MainDark border-surface rounded"
    >
      I am committed to passing the CPA exam and will dedicate the necessary time to study
    </Checkbox>

    <Checkbox
      name="privacy"
      required
      containerClassName="mb-6"
      checkboxClassName="w-4 h-4 text-MainDark border-surface rounded"
    >
      I have read and agree to the{" "}
      <Button
        variant="link"
        href="/privacy-policy"
        target="_blank"
        rel="noopener noreferrer"
      >
        Privacy Policy
      </Button>
    </Checkbox>

    <Button variant="secondary" type="submit" className="w-full mx-auto">
      Submit Scholarship Application
    </Button>
  </FormWrapper>
</div>
